[üá∫üá∏ English](./README.md) | [üá∑üá∫ –†—É—Å—Å–∫–∏–π](./README-ru.md)  | [üá®üá≥ ‰∏≠Êñá](./README-zh.md)

# patch-component-schema

–ü—Ä–∞–≤–∏–ª–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å—Ö–µ–º—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤ OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏.



## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä    | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                 | –ü—Ä–∏–º–µ—Ä                                                                       | –¢–∏–ø–∏–∑–∞—Ü–∏—è                                        | –î–µ—Ñ–æ–ª—Ç–Ω–æ–µ                                |
| -------- |------------------------------------------------------------------------------------------|------------------------------------------------------------------------------|--------------------------------------------------|------------------------------------------|
| `descriptor`  | [**–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π**] –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏. [–ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –ø—Ä–æ—Å—Ç—ã–º –∏ –æ–±—ä–µ–∫—Ç–Ω—ã–º –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Å –∫–æ—Ä—Ä–µ–∫—Ü–∏–µ–π](../../../docs/descriptor-ru.md) | `"Pet.name"` –∏–ª–∏ `{"componentName": "Pet", "correction": "properties.name"}` | `string | ComponentWithCorrectionDescriptorConfig` | - |
| `patchMethod`  | –ú–µ—Ç–æ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ç—á–∞. [–ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –º–µ—Ç–æ–¥–∞–º–∏ merge –∏ deepmerge](../../../docs/merge-vs-deepmerge-ru.md)  | `"merge"`                                                                    | `"merge" \                                       | "deepmerge"`                             | `"merge"` |
| `schemaDiff`  | [**–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π**] –°—Ö–µ–º–∞ –¥–ª—è –ø–∞—Ç—á–∞. [–ü–æ–¥—Ä–æ–±–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π –¥–ª—è OpenAPI](../../../docs/schema-diff-ru.md)                          | `{"type": "string", "description": "New description"}`                       | `OpenAPISchemaConfig`                            | -                                        |

> [!IMPORTANT]
> –¢–æ–Ω–∫–æ—Å—Ç–∏ –∑–∞–¥–∞—á–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `descriptor`:
> - –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ $ref'–∞–º. –ü–æ—Ç–æ–º—É —á—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –Ω–µ –ø—Ä–µ–¥–Ω–∞–º–µ—Ä–µ–Ω–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ –æ–±—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö, –∏ —Ç–µ–º —Å–∞–º—ã–º —Å–æ–∑–¥–∞—Ç—å –Ω–µ –æ–∂–∏–¥–∞–Ω–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏. –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –ª—É—á—à–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é —Ç—É —Å—É—â–Ω–æ—Å—Ç—å –Ω–∞ –∫–æ—Ç–æ—Ä—É—é —Å—Å—ã–ª–∞–µ—Ç—Å—è $ref;
> - –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —ç–ª–µ–º–µ–Ω—Ç–∞–º –º–∞—Å—Å–∏–≤–∞ - –Ω—É–∂–Ω–æ –¥–æ—É—Ç–æ—á–Ω–µ–Ω–∏–µ –≤ `descriptor` (—Å–æ–æ—Ç–≤—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ `[]`), –Ω–∞–ø—Ä–∏–º–µ—Ä, `TestSchemaDTO[].test`
> - –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ oneOf, allOf, anyOf –Ω—É–∂–Ω–æ –¥–æ—É—Ç–æ—á–Ω–µ–Ω–∏–µ –≤ `descriptor` (—Å–æ–æ—Ç–≤—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ `oneOf[{number}]`, `allOf[{number}]` –∏–ª–∏ `anyOf[{number}]`), –Ω–∞–ø—Ä–∏–º–µ—Ä, `TestObjectDTO.oneOf[1].TestSchemaDTO`, `TestObjectDTO.allOf[1].TestSchemaDTO` –∏–ª–∏  `TestObjectDTO.anyOf[1].TestSchemaDTO`;

–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```js
module.exports = {
    pipeline: [
        // ... other rules
        {
            rule: "patch-component-schema",
            config: {
                descriptor: 'TestDTO',
                schemaDiff: {
                    type: 'string',
                },
            },
        }
        // ... other rules
    ]
}
```

–ü—Ä–∏–º–µ—Ä –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```js
module.exports = {
    pipeline: [
        // ... other rules
        {
            rule: "patch-component-schema",
            config: {
                descriptor: 'TestObjectDTO.oneOf[0].TestArraySchemaDTO[]',
                schemaDiff: {
                    type: 'string',
                    enum: ['foo', 'bar'],
                },
                patchMethod: 'deepmerge',
            },
        }
        // ... other rules
    ]
}
```

**–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π**, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –¥–∞–Ω–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ –≤ –æ–±—â–µ–º –ø–∞–π–ª–∞–π–Ω–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

## –ú–æ—Ç–∏–≤–∞—Ü–∏—è

<a name="custom_anchor_motivation_1"></a>
### 1. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–Ω–æ–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞ –≤ —Å—Ö–µ–º–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä:

**–í —Ñ–∞–π–ª–µ `openapi.yaml`** —Å—Ö–µ–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

```yaml
components:
  schemas:
    Pet:
      type: object
      properties:
        status:
          type: string
          enum:
            - status1
            - status2
```

**–ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ `type`, —Ä–∞—Å—à–∏—Ä–∏–≤ enum –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏.**

**–í —Ñ–∞–π–ª–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** `openapi-modifier-config.js` –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∞–≤–∏–ª–æ `patch-component-schema`:

```js
module.exports = {
    pipeline: [
        {
            rule: "patch-component-schema",
            config: {
                descriptor: "Pet.status",
                patchMethod: "deepmerge",
                schemaDiff: {
                    enum: ['status3', 'status4'],
                }
            },
        }
    ]
}
```

**–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞**, —Ñ–∞–π–ª `openapi.yaml` –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

```yaml
components:
  schemas:
    Pet:
      type: object
      properties:
        status:
          type: string
          enum:
            - status1
            - status2
            - status3
            - status4
```

<a name="custom_anchor_motivation_2"></a>
### 2. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä:

**–í —Ñ–∞–π–ª–µ `openapi.yaml`** —Å—Ö–µ–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

```yaml
components:
  schemas:
    Pet:
      type: object
      properties:
        name:
          type: string
```

**–ù—É–∂–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.**

**–í —Ñ–∞–π–ª–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** `openapi-modifier-config.js` –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∞–≤–∏–ª–æ `patch-component-schema`:

```js
module.exports = {
    pipeline: [
        {
            rule: "patch-component-schema",
            config: {
                descriptor: {
                    componentName: "Pet"
                },
                patchMethod: "merge",
                schemaDiff: {
                    type: "object",
                    properties: {
                        id: {
                            type: "string",
                            description: "Pet id"
                        },
                        age: {
                            type: "integer",
                            description: "Pet age"
                        }
                    }
                }
            },
        }
    ]
}
```

**–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞**, —Ñ–∞–π–ª `openapi.yaml` –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

```yaml
components:
  schemas:
    Pet:
      type: object
      properties:
        id:
          type: string
          description: Pet id
        age:
          type: integer
          description: Pet age
```

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

-

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ –≤ —Ç–µ—Å—Ç–∞—Ö](./index.test.ts)  
- [–†–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –ø—Ä–æ—Å—Ç—ã–º –∏ –æ–±—ä–µ–∫—Ç–Ω—ã–º –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Å –∫–æ—Ä—Ä–µ–∫—Ü–∏–µ–π](../../../docs/descriptor-ru.md)
- [–†–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –º–µ—Ç–æ–¥–∞–º–∏ merge –∏ deepmerge](../../../docs/merge-vs-deepmerge-ru.md)
- [–ü—Ä–∏–º–µ—Ä—ã —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π –¥–ª—è OpenAPI](../../../docs/schema-diff-ru.md)