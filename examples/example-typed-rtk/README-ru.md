# Пример генерации типов OpenAPI + RTK Query

Этот пример демонстрирует, как использовать спецификации OpenAPI для генерации TypeScript типов и их интеграции с RTK Query в React-приложении.

## Возможности

1. **Генерация типов из OpenAPI**
   - Использует `dtsgenerator` для генерации TypeScript типов из спецификации OpenAPI
   - Автоматически генерирует определения типов для запросов и ответов API
   - Включает пользовательские модификации типов с помощью `openapi-modifier`

2. **Интеграция с RTK Query**
   - Демонстрирует использование сгенерированных типов с RTK Query
   - Обеспечивает типобезопасные вызовы API и ответы
   - Показывает правильную типизацию для хуков запросов и мутаций

3. **Мок-сервер**
   - Использует Prism CLI для создания мок-сервера на основе спецификации OpenAPI
   - Симулирует ответы API для разработки и тестирования
   - Работает параллельно с сервером разработки

4. **Модификация типов**
   - Показывает, как добавлять предупреждающие комментарии к сгенерированным типам
   - Использует `openapi-modifier` для пост-обработки сгенерированных типов
   - Демонстрирует пользовательские преобразования типов

5. **Модификация спецификации OpenAPI**
   - Использует `openapi-modifier` для трансформации спецификации OpenAPI
   - Добавляет basePath ко всем эндпоинтам для единообразной обработки путей API
   - Позволяет выполнять пользовательские модификации спецификации API перед генерацией типов
   - Поддерживает различные правила трансформации через конфигурацию

## Начало работы

1. Установите зависимости:
   ```bash
   npm install
   ```

2. Сгенерируйте типы API:
   ```bash
   npm run generate-types
   ```

3. Запустите среду разработки:
   ```bash
   npm run dev
   ```
   Это запустит и мок-сервер, и сервер разработки React.

## Структура проекта

- `specs/counter-api.yaml` - Спецификация OpenAPI
- `src/api/types/` - Сгенерированные TypeScript типы
- `src/api/counterApi.ts` - Определение API для RTK Query
- `src/App.tsx` - Пример React-компонента, использующего API

## Доступные скрипты

- `npm run dev` - Запускает мок-сервер и сервер разработки React
- `npm run mock-api` - Запускает только мок-сервер
- `npm run prepare-openapi-types` - Подготавливает спецификацию OpenAPI, добавляя basePath ко всем эндпоинтам
- `npm run generate-types` - Генерирует TypeScript типы из спецификации OpenAPI
- `npm run prepare-generated-types` - Пост-обработка сгенерированных типов

## Как это работает

1. **Подготовка спецификации OpenAPI**
   - Исходная спецификация OpenAPI находится в `specs/counter-api.yaml`
   - `openapi-modifier` используется для подготовки спецификации путем добавления basePath ко всем эндпоинтам
   - Подготовленная спецификация сохраняется в `specs/prepared-counter-api.yaml`
   - Этот шаг обеспечивает единообразную обработку путей API во всем приложении

2. **Генерация типов**
   - Подготовленная спецификация OpenAPI определяет структуру API
   - `dtsgenerator` преобразует спецификацию в TypeScript типы
   - `openapi-modifier` добавляет пользовательские модификации к типам

3. **Настройка RTK Query**
   - Сгенерированные типы используются для определения эндпоинтов API
   - Автоматически создаются типобезопасные хуки запросов
   - Типы ответов выводятся из спецификации OpenAPI

4. **Мок-сервер**
   - Prism CLI читает спецификацию OpenAPI
   - Генерирует мок-ответы на основе спецификации
   - Обеспечивает реалистичную среду разработки

## Типобезопасность

Пример демонстрирует, как достичь полной типобезопасности:
- Типы запросов/ответов API генерируются из спецификации OpenAPI
- Эндпоинты RTK Query правильно типизированы
- TypeScript обеспечивает проверку типов на этапе компиляции
- Автодополнение в IDE для вызовов API и ответов
